# OBC Coin API

ä¸€ä¸ªç”¨äºåˆ›å»ºå’Œå‘å¸ƒä»£å¸çš„ API æœåŠ¡ï¼Œæ”¯æŒä»£å¸æ¨¡æ¿ç”Ÿæˆã€ç¼–è¯‘å’Œå‘å¸ƒåˆ° Benfen ç½‘ç»œã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸª™ ä»£å¸æ¨¡æ¿ç”Ÿæˆå’Œè‡ªå®šä¹‰
- ğŸ”§ è‡ªåŠ¨ç¼–è¯‘ Move æ™ºèƒ½åˆçº¦
- ğŸš€ ä¸€é”®å‘å¸ƒåˆ° Benfen ç½‘ç»œ
- ğŸ“ æ¸…æ™°çš„å‚æ•°ç»“æ„å’Œé”™è¯¯å¤„ç†

## API æ¥å£

### 1. æ·»åŠ ä»£å¸ - `/api/token/add`

åˆ›å»ºä»£å¸æ¨¡æ¿å¹¶ç¼–è¯‘ç”Ÿæˆå­—èŠ‚ç ã€‚

**è¯·æ±‚æ–¹æ³•ï¼š** `POST`

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "decimal": 8,
  "symbol": "TEST",
  "name": "Test Token",
  "description": "A test token for complete workflow",
  "json": {
    "website": "https://test.com",
    "twitter": "@test"
  }
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "ä»£å¸æ·»åŠ å’Œç¼–è¯‘æˆåŠŸ",
  "data": {
    "compile_output": "ç¼–è¯‘è¾“å‡ºä¿¡æ¯...",
    "output_file": "/path/to/generated/file.move",
    "request": {...}
  }
}
```

### 2. å‘å¸ƒä»£å¸ - `/api/token/publish`

å°†ç¼–è¯‘åçš„ä»£å¸å‘å¸ƒåˆ° Benfen ç½‘ç»œã€‚

**è¯·æ±‚æ–¹æ³•ï¼š** `POST`

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "sender": "å‘é€è€…åœ°å€",
  "compiled_modules": ["ç¼–è¯‘åçš„æ¨¡å—æ•°ç»„"],
  "dependencies": ["ä¾èµ–é¡¹æ•°ç»„"],
  "gas_budget": "Gas é¢„ç®—"
}
```

## å®Œæ•´æµ‹è¯•æµç¨‹

### æ­¥éª¤ 1ï¼šåˆ›å»ºä»£å¸

```bash
curl -X POST http://localhost:8080/api/token/add \
  -H "Content-Type: application/json" \
  -d '{
    "decimal": 8,
    "symbol": "TEST",
    "name": "Test Token",
    "description": "A test token for complete workflow",
    "json": {
      "website": "https://test.com",
      "twitter": "@test"
    }
  }'
```

**é¢„æœŸå“åº”ï¼š**
- çŠ¶æ€ç ï¼š200
- åŒ…å«ç¼–è¯‘è¾“å‡ºã€æ¨¡å—å’Œä¾èµ–ä¿¡æ¯
- å“åº”æ—¶é—´ï¼šçº¦ 2-3 ç§’

### æ­¥éª¤ 2ï¼šå‘å¸ƒä»£å¸

ä½¿ç”¨æ­¥éª¤ 1 è¿”å›çš„ç¼–è¯‘ç»“æœï¼š

```bash
curl -X POST http://localhost:8080/api/token/publish \
  -H "Content-Type: application/json" \
  -d '{
    "sender": "BFC6f0f9a9a72f7d48b8fcbfa09ebb61123d847aaad5760297d68c64795bad514b14a89",
    "compiled_modules": ["ä»æ­¥éª¤1è·å–çš„ç¼–è¯‘æ¨¡å—"],
    "dependencies": ["ä»æ­¥éª¤1è·å–çš„ä¾èµ–é¡¹"],
    "gas_budget": "5000000000"
  }'
```

**é¢„æœŸå“åº”ï¼š**
- çŠ¶æ€ç ï¼š200
- æ¥è‡ª Benfen RPC çš„å‘å¸ƒç»“æœ
- å“åº”æ—¶é—´ï¼šçº¦ 300-500 æ¯«ç§’

## é…ç½®è¯´æ˜

æœåŠ¡å™¨é…ç½®æ–‡ä»¶ `config.yaml`ï¼š

```yaml
bfc:
  directory: "/path/to/bfc"
  binary_path: "/path/to/bfc/target/debug/bfc"
  token_template_path: "/path/to/token/template"

benfen_rpc:
  url: "https://devrpc2.benfen.org/"
  timeout: 30
  retry_count: 3

server:
  port: 8080
```

## å¯åŠ¨æœåŠ¡

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ä¸€é”®è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd obc_coin_api

# å®‰è£…ä¾èµ–
go mod tidy

# å¯åŠ¨æœåŠ¡
./start.sh

# æŸ¥çœ‹çŠ¶æ€
./status.sh

# åœæ­¢æœåŠ¡
./stop.sh

# é‡å¯æœåŠ¡
./restart.sh
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

```bash
# ç›´æ¥è¿è¡Œ
go run .
```

æœåŠ¡å¯åŠ¨åå°†åœ¨ `localhost:8080` ç›‘å¬è¯·æ±‚ã€‚

## æœåŠ¡ç®¡ç†è„šæœ¬

é¡¹ç›®æä¾›äº†å®Œæ•´çš„æœåŠ¡ç®¡ç†è„šæœ¬ï¼š

- `./start.sh` - å¯åŠ¨æœåŠ¡ï¼ˆåå°è¿è¡Œï¼‰
- `./stop.sh` - åœæ­¢æœåŠ¡
- `./restart.sh` - é‡å¯æœåŠ¡
- `./status.sh` - æŸ¥çœ‹æœåŠ¡çŠ¶æ€

**è„šæœ¬ç‰¹æ€§ï¼š**
- ğŸ”„ è‡ªåŠ¨è¿›ç¨‹ç®¡ç†å’Œ PID æ–‡ä»¶å¤„ç†
- ğŸ“ æ—¥å¿—æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆï¼ˆ`obc_coin_api.log`ï¼‰
- ğŸ¥ å¥åº·æ£€æŸ¥å’ŒçŠ¶æ€ç›‘æ§
- ğŸ›¡ï¸ å®‰å…¨çš„å¯åœæµç¨‹
- ğŸ§¹ è‡ªåŠ¨æ¸…ç†è¿‡æœŸçš„ä¸´æ—¶ç›®å½•

## è‡ªåŠ¨æ¸…ç†åŠŸèƒ½

æœåŠ¡å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨å¯åŠ¨å®šæ—¶æ¸…ç†ä»»åŠ¡ï¼š

- **æ¸…ç†é¢‘ç‡**: å¯åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®æ‰§è¡Œé—´éš”
- **æ¸…ç†è§„åˆ™**: å¯åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ç›®å½•ä¿ç•™æ—¶é—´
- **æ¸…ç†èŒƒå›´**: åªæ¸…ç† `coin_tmp_æ—¶é—´æˆ³` æ ¼å¼çš„ç›®å½•
- **æ—¥å¿—è®°å½•**: è¯¦ç»†è®°å½•æ¸…ç†è¿‡ç¨‹å’Œç»“æœ
- **é…ç½®åŒ–**: æ”¯æŒé€šè¿‡ `config.yaml` è‡ªå®šä¹‰æ¸…ç†å‚æ•°

### æ¸…ç†é…ç½®

åœ¨ `config.yaml` ä¸­å¯ä»¥é…ç½®æ¸…ç†ä»»åŠ¡å‚æ•°ï¼š

```yaml
# æ¸…ç†ä»»åŠ¡é…ç½®
cleanup:
  # æ¸…ç†ä»»åŠ¡æ‰§è¡Œé—´éš”ï¼ˆåˆ†é’Ÿï¼‰
  interval_minutes: 10
  # ç›®å½•ä¿ç•™æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
  retention_minutes: 10
```

- `interval_minutes`: æ¸…ç†ä»»åŠ¡æ‰§è¡Œé—´éš”ï¼Œé»˜è®¤10åˆ†é’Ÿ
- `retention_minutes`: ä¸´æ—¶ç›®å½•ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤10åˆ†é’Ÿ

### æ¸…ç†æ—¥å¿—ç¤ºä¾‹

```
2025/07/30 15:40:35 å¯åŠ¨å®šæ—¶æ¸…ç†ä»»åŠ¡: æ¯10åˆ†é’Ÿæ¸…ç†ä¸€æ¬¡è¶…è¿‡10åˆ†é’Ÿçš„ä¸´æ—¶ç›®å½•
2025/07/30 15:40:35 æ¸…ç†ä»»åŠ¡: æˆåŠŸåˆ é™¤è¿‡æœŸç›®å½• coin_tmp_1753857838 (å­˜åœ¨æ—¶é—´: 56m37s)
2025/07/30 15:40:35 æ¸…ç†ä»»åŠ¡å®Œæˆ: å…±æ¸…ç† 3 ä¸ªè¿‡æœŸç›®å½•
```

## é”™è¯¯å¤„ç†

æ‰€æœ‰æ¥å£éƒ½åŒ…å«ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼ï¼š

```json
{
  "success": false,
  "message": "é”™è¯¯æè¿°ä¿¡æ¯"
}
```

å¸¸è§é”™è¯¯ï¼š
- 400ï¼šè¯·æ±‚å‚æ•°æ ¼å¼é”™è¯¯
- 500ï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼ˆç¼–è¯‘å¤±è´¥ã€ç½‘ç»œé”™è¯¯ç­‰ï¼‰

## æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶ï¼š** Go + Gorilla Mux
- **æ™ºèƒ½åˆçº¦ï¼š** Move è¯­è¨€
- **ç¼–è¯‘å·¥å…·ï¼š** BFC (Benfen Compiler)
- **ç½‘ç»œï¼š** Benfen åŒºå—é“¾ç½‘ç»œ

## å¼€å‘è¯´æ˜

é¡¹ç›®ç»“æ„ï¼š
```
â”œâ”€â”€ config.go          # é…ç½®æ–‡ä»¶å¤„ç†
â”œâ”€â”€ config.yaml        # æœåŠ¡é…ç½®
â”œâ”€â”€ handlers.go        # API å¤„ç†å‡½æ•°
â”œâ”€â”€ main.go           # æœåŠ¡å…¥å£
â””â”€â”€ templates/        # ä»£å¸æ¨¡æ¿ç›®å½•
```

ä¸»è¦åŠŸèƒ½æ¨¡å—ï¼š
- `addToken`: ä»£å¸æ¨¡æ¿ç”Ÿæˆå’Œç¼–è¯‘
- `publishToken`: ä»£å¸å‘å¸ƒåˆ°åŒºå—é“¾
- `compileMoveProject`: Move é¡¹ç›®ç¼–è¯‘
- `processTemplate`: æ¨¡æ¿æ–‡ä»¶å¤„ç†